# Snapshot report for `src/lib/rollup-plugin-ava-test-to-example.unit.js`

The actual snapshot is saved in `rollup-plugin-ava-test-to-example.unit.js.snap`.

Generated by [AVA](https://avajs.dev).

## Rollup plugin transforms example code of files with local unit test

> Snapshot 1

    `import fs from 'fs'␊
    import { avaTestToExample } from './ava-test-to-example'␊
    import { parseAvaFile } from './parse-ava'␊
    import { pathExists } from 'fs-extra'␊
    import util from 'util'␊
    ␊
    const readFile = util.promisify(fs.readFile)␊
    ␊
    /**␊
     * Embeds corresponding unit tests into the js-doc @example tag of a js file␊
     * @param {Object} options␊
     * @param {String} [options.suffix=.unit.js]␊
     * @return {Function}␊
     * @example <caption>Rollup plugin transforms example code of files with local unit test</caption>␊
     * ␊
     * ```js␊
     * const id = path.join(__dirname, './rollup-plugin-ava-test-to-example.js')␊
     * const plugin = at2e()␊
     * const code = fs.readFileSync(id).toString()␊
     * ␊
     * const res = await plugin.transform(code, id)␊
     * t.truthy(res.code)␊
     * t.snapshot(res.code)␊
     * ```␊
     */␊
    export default function ({ suffix = `.unit.js` } = {}) {␊
      const css = []␊
      let generated = false␊
      return {␊
        name: 'rollup-plugin-ava-test-to-example',␊
        async transform (code, id) {␊
          if (/\\.js$/.test(id)) {␊
            const unit = id.replace(/\\.js$/i, suffix)␊
            if (await pathExists(unit)) {␊
              const examples = (await parseAvaFile(unit)).map(avaTestToExample)␊
              code = code.replace(/^ \\* +@example +<test/mg, examples.join('\\n\\n').split('\\n').map(l => ` * ${ l }`).join('\\n'))␊
            }␊
            return { code }␊
          }␊
          return null␊
        }␊
      }␊
    }␊
    `
